% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/md_data.r
\name{md_data}
\alias{md_data}
\title{Load and Process World Panel Data}
\usage{
md_data(
  ISO,
  formula,
  variable = NULL,
  years,
  adjust_seasonal = FALSE,
  window_seasadj = NULL,
  matching_yq = "Q2Y",
  interpolation_method = "Linear",
  aggregate_iso = NULL,
  aggregate_period = NULL,
  quartile = FALSE,
  na.rm = TRUE,
  reference = TRUE,
  country_names = FALSE,
  clean = FALSE,
  na2zero = FALSE,
  verbose = TRUE,
  debug = FALSE
)
}
\arguments{
\item{ISO}{character vector; ISO 3-letter country codes or category names:
- Individual countries (e.g., "USA", "CHN")
- Categories (e.g., "CTR_LDR", "BRICS", "AFRICA")
- Category exclusions using hyphen (e.g., "CTR_LDR - USA")
See wp_get_category() for available categories.}

\item{formula}{character vector; mathematical expressions using Symbol codes:
- Simple variables (e.g., "GDP_C")
- Calculations with basic operators (e.g., "100*CU_C/GDP_C")
- Multiple formulas as vector
- Basic operators: + - * / ( )
Division by zero not handled, use with caution.}

\item{variable}{character vector or NULL; names for formula outputs (Column Variable):
- Must match length of formula if provided
- Used for output labeling and plotting
Default is NULL, using formula as names.}

\item{years}{numeric vector of length 2; year range; c(start_year, end_year):
- First element: start year
- Second element: end year
Data availability varies by country/indicator.}

\item{adjust_seasonal}{logical (TRUE/FALSE); apply seasonal adjustment:
- TRUE: adjust quarterly data using STL decomposition
- Only affects quarterly data (no effect on annual)
Default is FALSE.}

\item{window_seasadj}{numeric or NULL (= 7); window for seasonal adjustment:
- Controls smoothing in STL decomposition
- Larger values = more smoothing
- Only used if adjust_seasonal = TRUE
Default is 7.}

\item{matching_yq}{character; method for handling mixed frequencies:
- "Q2Y": convert quarterly to yearly
- "Y2Q": convert yearly to quarterly
Default is "Q2Y".}

\item{interpolation_method}{character; method for Y2Q conversion:
- "None": repeat yearly value
- "Linear": linear interpolation
- "Linear-Scale": scaled linear interpolation
Only used if matching_yq = "Y2Q".}

\item{aggregate_iso}{character or NULL; method for country aggregation:
- "Sum": sum values across countries
- "Mean": average values across countries
- "Median": median values across countries
- NULL: no aggregation}

\item{aggregate_period}{character or NULL; method for time aggregation:
- "Sum": sum over period
- "Mean"/"Median": central tendency
- "SD": standard deviation
- "Growth": period-over-period growth
- "CAGR": compound annual growth rate
- "GeoMean": geometric mean
- NULL: no aggregation}

\item{quartile}{logical; include quartile calculations:
- TRUE: add first/third quartiles to aggregations
- Only used if aggregate_iso or aggregate_period is specified
Default is FALSE.}

\item{na.rm}{logical; handle missing values in aggregations:
- TRUE: exclude NA values
- FALSE: return NA if any value is NA
Default is TRUE.}

\item{reference}{logical; include data source citations:
- TRUE: add Reference column to output
Default is TRUE.}

\item{country_names}{logical; include full country names:
- TRUE: add Country column with names from ISO codes
Default is FALSE.}

\item{clean}{logical; remove rows with NA values:
- TRUE: remove NA rows from final output
Default is FALSE.}

\item{na2zero}{logical; transform NA values into zeros:
- TRUE: remove NA values and replace them by zeros
Default is FALSE.}

\item{verbose}{logical; print processing information:
- TRUE: show progress and warnings
Default is TRUE.}

\item{debug}{logical; print detailed debugging information:
- TRUE: show technical details
Default is FALSE.}
}
\value{
A data.frame containing:
\itemize{
\item ISO: 3-letter country codes
\item Date: time period (YYYY or YYYYQN format)
\item Variable: indicator names from formula/variable
\item Value: calculated values
\item Reference: data sources (if reference=TRUE)
\item Country: country names (if country_names=TRUE)
}
}
\description{
Loads and processes data from a comprehensive panel database containing economic,
financial, and development indicators. The function handles data filtering,
frequency adjustments, aggregation, and seasonal adjustments. Memory usage is
optimized by loading data on demand (approximately 15-50MB during execution).
}
\details{
The function processes data in several steps:
\enumerate{
\item Validates inputs and resolves country categories
\item Loads required data (quarterly/yearly) on demand
\item Extracts symbols from formulas and filters data
\item Handles frequency mismatches (Q2Y or Y2Q conversion)
\item Evaluates formulas for each country
\item Performs any requested aggregations
\item Applies seasonal adjustments if specified
\item Cleans and formats output
}

Memory usage is optimized by:
\itemize{
\item Loading data only when needed
\item Filtering to required columns early
\item Processing one formula at a time
\item Clearing intermediate objects
}

Data Validation and Error Handling:
\itemize{
\item Missing data warnings by country/variable
\item Automatic date range adjustment if requested years unavailable
\item Minimum observations check for seasonal adjustment (16 required)
\item Warnings for inappropriate aggregation requests (e.g., growth rates with negative values)
}

Variable Types and Units:
\itemize{
\item Stock variables: measured at a point in time (e.g., reserves, debt)
\item Flow variables: measured over a period (e.g., GDP, trade)
\item Index variables: base year representations (various base years available)
\item Percentage variables: bounded ratios
\item For IMF Balance of Payments data, quarterly values are multiplied by 4 to represent
annualized flows, ensuring consistency with yearly data
}

Common Data Patterns:
World Bank (WB) indicators:
\itemize{
\item _ZS suffix: ratios expressed as percentages
\item _CD suffix: current US dollars
\item _KD suffix: constant dollars
\item _XD suffix: indices
\item _PC suffix: per capita values
\item _FE/_MA suffixes: female/male specific indicators
}

IMF Balance of Payments (BOP):
\itemize{
\item _C suffix: current prices
\item _R suffix: real/constant prices (with base year)
\item o/i prefixes: outward/inward flows
\item DI/POR/OI suffixes: direct investment/portfolio/other investment
\item E/D suffixes: equity/debt components
}

Natural Disasters (EMDAT):
\itemize{
\item DIS prefix: disaster-related indicators
\item _AFF/_DEATH/_DMG suffixes: affected people/fatalities/economic damage
\item BIO/CLIM/GEO/HYDRO prefixes: biological/climatic/geological/hydrological disasters
}

Financial Market Data (BIS):
\itemize{
\item CRED prefix: credit-related indicators
\item _ALL/_BANK prefixes: all sectors/banking sector
\item _CD/_KN/_ZS suffixes: USD/local currency/percentage of GDP
}

Other specialized databases (JST, KOF, etc.) have their own consistent naming patterns
that are documented in their respective sources.
}
\note{
Variables in formulas refer to Symbol codes in the underlying database.
Users should understand the economic/financial meaning of variables
and their units before performing calculations.
}
\examples{
# Basic usage - GDP ratio for one country
data <- wp_data(
  ISO = "USA",
  formula = "100*CU_C/GDP_C",
  variable = "Current Account (\% GDP)",
  years = c(2000, 2023)
)

# Multiple countries and indicators with aggregation
data <- wp_data(
  ISO = c("CHN", "JPN", "KOR"),
  formula = c("EXg_C/GDP_C", "IMg_C/GDP_C"),
  variable = c("Exports", "Imports"),
  years = c(2010, 2023),
  adjust_seasonal = TRUE,
  aggregate_iso = "Mean"
)

# Using categories with exclusions
data <- wp_data(
  ISO = "CTR_LDR - USA",
  formula = "FA_C/GDP_C",
  years = c(1990, 2023),
  adjust_seasonal = TRUE,
  aggregate_period = "Growth"
)

# Mixed frequency handling
data <- wp_data(
  ISO = "DEU",
  formula = c("GDP_R_2015_Y", "CU_C"),
  years = c(2015, 2023),
  matching_yq = "Y2Q",
  interpolation_method = "Linear"
)

}
\seealso{
\code{\link{wp_plot_series}} for plotting time series
\code{\link{wp_plot_scatter}} for scatter plots
\code{\link{wp_plot_bar}} for bar plots
\code{\link{wp_get_category}} for available country categories
}
\concept{data functions}
